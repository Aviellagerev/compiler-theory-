
CPQ: CPL to Quad Compiler

This project is a compiler for CPL (Compiler Project Language), a simple procedural language defined for the "Compilation" course (20364) at The Open University. The compiler, named cpq, parses CPL source code and translates it into an intermediate representation called Quad, a simple assembly-like language.

Project Structure

The compiler is written in C and uses flex for lexical analysis and bison for parsing.
cpq.c / cpq.h: The main driver for the compiler. It handles command-line arguments, file I/O, and initiates the parsing process.
lexer.l: The flex definition file. It defines the tokens (keywords, operators, identifiers, numbers) of the CPL language.
parser.y: The bison grammar file. It defines the CPL language syntax and contains semantic actions that are executed as the source file is parsed.
translator.c / translator.h: The code generation module. These files contain functions to build, manage, and print the list of Quad commands that form the compiler's output.
symboltab.c / symboltab.h: The symbol table implementation. It uses a hash table to store information about variables, such as their type and state.
error.c / error.h: A simple error-reporting module used by the parser and lexer to print formatted error messages, including line numbers.
makefile: Used to build the cpq executable from all the source files using gcc, flex, and bison.
qx.py: A Python-based interpreter for executing the .qud files generated by the compiler.
test/: A directory containing sample CPL source files (.ou) and their corresponding compiled Quad output (.qud).

How it Works

Lexical Analysis: The lexer.l file defines rules to break the .ou source file into a stream of tokens (e.g., IF, ID, NUM, ADDOP).
Parsing: The parser.y file defines the CPL grammar. It consumes the token stream from the lexer and builds a parse tree.
Semantic Actions & Code Generation: As the parser validates the grammar, it executes C code (semantic actions) embedded in the parser.y file. These actions:
Use the Symbol Table (symboltab.c) to declare variables, check for re-declarations, and look up variable types.
Use the Translator (translator.c) to build a list of Quad commands. For example, an if statement is translated into comparison instructions (like ILSS) and jump instructions (JMPZ).
Error Handling: If the source code violates the CPL language rules (lexically, syntactically, or semantically), the compiler reports an error using the report_error function and stops, deleting any incomplete .qud file.
Output: If compilation is successful, the main function prints the final list of Quad commands to the .qud output file.

How to Use


1. Build the Compiler

You will need gcc, flex, and bison installed. Run the make command in the project's root directory:

Bash


make


This will create the executable file named cpq.

2. Compile a CPL File

To compile a CPL source file (e.g., test/fibo.ou), run the cpq executable with the file as an argument:

Bash


./cpq test/fibo.ou


This will generate a test/fibo.qud file if the compilation is successful.

3. Run the Compiled Code

You can execute the generated .qud file using the provided Python interpreter qx.py:

Bash


python qx.py test/fibo.qud


